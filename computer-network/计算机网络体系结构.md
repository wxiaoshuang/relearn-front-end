# 计算机网络体系结构
## 协议与划分层次
为进行网络中的数据交换而建立的规则、标准或约定称为网络协议(networkprotocol)。网络协议也可简称为协议。

网络协议主要由以下三个要素组成：

(1) 语法，即数据与控制信息的结构或格式；

(2) 语义，即需要发出何种控制信息，完成何种动作以及做出何种响应；

(3) 同步，即事件实现顺序的详细说明。

(1) 应用层(application layer)

应用层是体系结构中的最高层。

应用层的任务是通过应用进程间的交互来完成特定网络应用。

应用层协议定义的是应用进程间通信和交互的规则。这里的进程(process)就是指主机中正在运行的程序。对于不同的网络应用需要有不同的应用层协议。在因特网中的应用层协议很多，如支持万维网应用的HTTP协议，支持电子邮件的SMTP协议，支持文件传送的FTP协议，等等。

我们将应用层交互的数据单元称为报文(message)。

(2) 运输层(transport layer)

**运输层的任务就是负责向两个主机中进程之间的通信提供通用的数据传输服务**。应用进程利用该服务传送应用层报文。所谓通用，是指并不针对某个特定网络应用，而是多种应用可以使用同一个运输层服务。由于一台主机可同时运行多个进程，因此运输层有复用和分用的功能。复用就是多个应用层进程可同时使用下面运输层的服务，分用与复用相反，是运输层把收到的信息分别交付上面应用层中的相应进程。

运输层主要使用以下两种协议：

● 传输控制协议TCP (Transmission Control Protocol)——提供面向连接的、可靠的数据传输服务，其数据传输的单位是报文段(segment)。

● 用户数据报协议 UDP (User Datagram Protocol)——提供无连接的、尽最大努力(best-effort)的数据传输服务（不保不保证数据传输的可靠性），其数据传输的单位是用户数据报。

(3) 网络层(network layer)

**网络层负责为分组交换网上的不同主机提供通信服务**。**在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组或包(packet)进行传送**。在TCP/IP体系中，由于网络层使用IP协议，因此分组也叫作 IP数据报，或简称为数据报(datagram)。

注意：不要将运输层的“用户数据报UDP”和网络层的“IP数据报”弄混。此外，无论在哪一层传送的数据单元，都可笼统地用“分组”来表示。

网络层的另一个任务就是要选择合适的路由，使源主机运输层所传下来的分组能够通过网络中的路由器找到目的主机。

(4) 数据链路层(data link layer)

数据链路层常简称为链路层。

两台主机之间的数据传输，总是在一段一段的链路上传送的，这就需要使用专门的链路层的协议。

**在两个相邻结点之间传送数据时，数据链路层将网络层交下来的IP数据报组装成帧（framing），在两个相邻结点间的链路上传送帧（frame）**。每一帧包括数据和必要的控制信息（如同步信息、地址信息、差错控制等）。在接收数据时，控制信息使接收端能够知道一个帧从哪个比特开始和到哪个比特结束。这样，数据链路层在收到一个帧后，就可从中提取出数据部分，上交给网络层。控制信息还使接收端能够检测到所收到的帧中有无差错。如发现有差错，数据链路层就简单地丢弃这个出了差错的帧，以免继续在网络中传送下去白白浪费网络资源。如果需要改正数据在数据链路层传输时出现的差错（这就是说，数据链路层不仅要检错，而且要纠错），那么就要采用可靠传输协议来纠正出现的差错。

(5) 物理层(physical layer)

**在物理层上所传数据的单位是比特**。

发送方发送1（或0）时，接收方应当收到1（或0）而不是0（或1）。因此物理层要考虑用多大的电压代表“1”或“0”，以及接收方如何识别出发送方所发送的比特。物理层还要确定连接电缆的插头应当有多少根引脚以及各条引脚应如何连接

## 实体、协议、服务和服务访问点

研究开放系统中的信息交换时，往往使用**实体(entity)这一较为抽象的名词表示任何可发送或接收信息的硬件或软件进程**。在许多情况下，实体就是一个特定的软件模块。协议是控制两个对等实体（或多个实体）进行通信的规则的集合

协议在语法方面的规则定义了所交换的信息的格式；而协议在语义方面的规则就定义了发送者或接收者所要完成的操作，例如，在何种条件下数据必须重传或丢弃；协议在同步方面的规则定义了收发双方的时序关系，即在一定条件下应当发生什么事件。

**在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。要实现本层协议，还需要使用下面一层所提供的服务**。

一定要弄清楚，协议和服务在概念上是很不一样的。

首先，协议的实现保证了能够向上一层提供服务。使用本层服务的实体只能看见服务而无法看见下面的协议。也就是说，下面的协议对上面的实体是透明的。

其次，**协议是“水平的”**，即**协议是控制对等实体之间通信的规则**。**但服务是“垂直的”，即服务是由下层向上层通过层间接口提供的**。另外，并非在一个层内完成的全部功能都称为服务。只有那些能够被高一层实体“看得见”的功能才能称之为“服务”


